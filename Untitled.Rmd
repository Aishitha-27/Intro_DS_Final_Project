---
title: "Understanding Sales patterns and return dynamics in E-Commerce"
author: Team 3
output: html_document
date: "2024-11-13"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r basic_libraries, include=FALSE}
library(ezids)
library(ggplot2)
library(dplyr)
library(leaflet)
library(tidyverse)
library(outliers)
```


#Glimpse of a dataset
```{r}
data=read.csv("online_sales_dataset.csv")
head(data, 5)
```
## Structure and Summary of Dataset

```{r}
str(data)
```


```{r}
xkablesummary(data, title = "Summary of Dataset")
```
Looking for missing values
```{r}
colSums(is.na(data))
```

```{r}
data_clean<- na.omit(data)
```


```{r}
colSums(is.na(data_clean))
```


```{r}
dim(data_clean)
```

Applying random sample of 10,000 rows for our project
```{r}
set.seed(123) 
data_reduced <- data_clean %>% sample_n(10000)
```

```{r}
nrow(data_reduced)
```

```{r}
dim(data_reduced)
```
```{r}

# Boxplot for Quantity to visualize outliers

ggplot(data_reduced, aes(x = "", y = Quantity)) +
    geom_boxplot(fill = "lightblue", color = "darkblue") +
    labs(title = "Boxplot of Quantity", y = "Quantity") +
    theme_minimal()

# Boxplot for UnitPrice to visualize outliers

ggplot(data_reduced, aes(x = "", y = UnitPrice)) +
    geom_boxplot(ofill = "lightblue", color = "darkblue") +
    labs(title = "Boxplot of UnitPrice", y = "Unit Price") +
    theme_minimal()

# Boxplot for Discount to visualize outliers

ggplot(data_reduced, aes(x = "", y = Discount)) +
    geom_boxplot(fill = "lightblue", color = "darkblue") +
    labs(title = "Boxplot of Discount", y = "Discount") +
    theme_minimal()
```


```{r}
# Function to identify outliers using kernel density estimation
kd2_outliers <- function(column) {
  density <- density(column, na.rm = TRUE)
  threshold <- 0.01  # Define a threshold for low-density regions
  outlier_indices <- which(density(column)$y < threshold)
  return(outlier_indices)
}

# Identify outliers in data_reduced using kd2
outliers_quantity <- kd2_outliers(data_reduced$Quantity)
outliers_unit_price <- kd2_outliers(data_reduced$UnitPrice)
outliers_discount <- kd2_outliers(data_reduced$Discount)

# Print outlier indices
print("Outliers in Quantity (by kd2):")
print(outliers_quantity)

print("Outliers in Unit Price (by kd2):")
print(outliers_unit_price)

print("Outliers in Discount (by kd2):")
print(outliers_discount)

# Function to remove outliers from a specific column using kd2
remove_kd2_outliers <- function(df, column) {
  density <- density(df[[column]], na.rm = TRUE)
  threshold <- 0.01  # Define a threshold for low-density regions
  outlier_indices <- which(density$y < threshold)
  if (length(outlier_indices) > 0) {
    df <- df[-outlier_indices, ]
  }
  return(df)
}

# Remove outliers using kd2
cleaned_data <- data_reduced %>%
  remove_kd2_outliers("Quantity") %>%
  remove_kd2_outliers("UnitPrice") %>%
  remove_kd2_outliers("Discount")
```

```{r}
# Display the first few rows of the cleaned dataset
head(cleaned_data)
```

```{r}
head(data_reduced)
```