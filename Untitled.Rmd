---
title: "Understanding Sales patterns and return dynamics in E-Commerce"
author: Team 3
output: html_document
date: "2024-11-13"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r basic_libraries, include=FALSE}
library(ezids)
library(ggplot2)
library(dplyr)
library(leaflet)
library(tidyverse)
library(outliers)
```


#Glimpse of a dataset
```{r}
data=read.csv("online_sales_dataset.csv")
head(data, 5)
```
## Structure and Summary of Dataset

```{r}
str(data)
```


```{r}
xkablesummary(data, title = "Summary of Dataset")
```
Looking for missing values
```{r}
colSums(is.na(data))
```

```{r}
data_clean<- na.omit(data)
```


```{r}
colSums(is.na(data_clean))
```


```{r}
dim(data_clean)
```

Applying random sample of 10,000 rows for our project
```{r}
set.seed(123) 
data_reduced <- data_clean %>% sample_n(10000)
```

```{r}
nrow(data_reduced)
```

```{r}
dim(data_reduced)
```
```{r}

# Boxplot for Quantity to visualize outliers

ggplot(data_reduced, aes(x = "", y = Quantity)) +
    geom_boxplot(fill = "lightblue", color = "darkblue") +
    labs(title = "Boxplot of Quantity", y = "Quantity") +
    theme_minimal()

# Boxplot for UnitPrice to visualize outliers

ggplot(data_reduced, aes(x = "", y = UnitPrice)) +
    geom_boxplot(ofill = "lightblue", color = "darkblue") +
    labs(title = "Boxplot of UnitPrice", y = "Unit Price") +
    theme_minimal()

# Boxplot for Discount to visualize outliers

ggplot(data_reduced, aes(x = "", y = Discount)) +
    geom_boxplot(fill = "lightblue", color = "darkblue") +
    labs(title = "Boxplot of Discount", y = "Discount") +
    theme_minimal()
```


```{r}
kd2_outliers <- function(column) {
  density <- density(column, na.rm = TRUE)
  threshold <- 0.01  # Define a threshold for low-density regions
  outlier_indices <- which(density(column)$y < threshold)
  return(length(outlier_indices))  # Return the count of outliers
}

outliers_quantity <- kd2_outliers(data_reduced$Quantity)
outliers_unit_price <- kd2_outliers(data_reduced$UnitPrice)
outliers_discount <- kd2_outliers(data_reduced$Discount)

cat("Outliers in Quantity:", outliers_quantity, "\n")
cat("Outliers in Unit Price:", outliers_unit_price, "\n")
cat("Outliers in Discount:", outliers_discount, "\n")
```

```{r}
remove_kd2_outliers <- function(df, column) {
  density <- density(df[[column]], na.rm = TRUE)
  threshold <- 0.01  # Define a threshold for low-density regions
  outlier_indices <- which(density$y < threshold)
  if (length(outlier_indices) > 0) {
    df <- df[-outlier_indices, ]
  }
  return(df)
}

cleaned_data <- data_reduced %>%
  remove_kd2_outliers("Quantity") %>%
  remove_kd2_outliers("UnitPrice") %>%
  remove_kd2_outliers("Discount")
```

```{r}
str(cleaned_data)
```
```{r}
library(dplyr)
```
```{r}
library(ggplot2)
```
```{r}
# Check column names of cleaned_data
names(cleaned_data)

```
```{r}


str(cleaned_data)
head(cleaned_data)



```
```{r}
names(data_reduced)
```
```{r}
# Summarize Total Sales by Country
sales_by_country <- cleaned_data %>%
  group_by(Country) %>%
  summarise(TotalSales = sum(Quantity * UnitPrice * (1 - Discount), na.rm = TRUE), .groups = "drop")

# Plot Total Sales by Country
ggplot(data = sales_by_country, aes(x = reorder(Country, -TotalSales), y = TotalSales)) +
  geom_col(fill = "dodgerblue", width = 0.7) +
  labs(
    title = "Total Sales by Country",
    x = "Country",
    y = "Total Sales"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5, face = "bold")
  )


```
```{r}
# Summarize Quantity Sold by Category
quantity_by_category <- cleaned_data %>%
  group_by(Category) %>%
  summarise(TotalQuantity = sum(Quantity, na.rm = TRUE), .groups = "drop")

# Plot Quantity by Category
ggplot(data = quantity_by_category, aes(x = reorder(Category, TotalQuantity), y = TotalQuantity)) +
  geom_bar(stat = "identity", fill = "coral") +
  coord_flip() +
  labs(
    title = "Quantity Sold by Category",
    x = "Category",
    y = "Total Quantity"
  ) +
  theme_minimal()

```

```{r}
str(cleaned_data)
```
```{r}
# Summarize Quantity by Country and Category
quantity_country_category <- cleaned_data %>%
  group_by(Country, Category) %>%
  summarise(TotalQuantity = sum(Quantity, na.rm = TRUE), .groups = "drop")

# Plot Stacked Bar Chart
ggplot(data = quantity_country_category, aes(x = Country, y = TotalQuantity, fill = Category)) +
  geom_bar(stat = "identity") +
  labs(
    title = "Quantity Sold by Country and Category",
    x = "Country",
    y = "Total Quantity"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```



```{r}
library(dplyr)
library(ggplot2)
```
```{r}
# Count Payment Methods and Calculate Percentages
payment_methods <- cleaned_data %>%
  group_by(PaymentMethod) %>%
  summarise(Count = n(), .groups = "drop") %>%
  mutate(Percentage = round(100 * Count / sum(Count), 1))

# Plot Payment Method Distribution with Percentages
ggplot(data = payment_methods, aes(x = "", y = Count, fill = PaymentMethod)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) +
  geom_text(aes(label = paste0(Percentage, "%")), 
            position = position_stack(vjust = 0.5), 
            size = 4, 
            color = "white") +
  labs(
    title = "Distribution of Payment Methods",
    x = "",
    y = ""
  ) +
  theme_void() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"))


```
```{r}
install.packages("tidyr")  # Install if not already installed
library(tidyr)             # Load the package
```
```{r}
library(reshape2)  
```
```{r}
names(cleaned_data)
```
```{r}
library(lubridate)
```
```{r}


```

```{r}


```


```{r}
# Sales Distribution by Order Priority
sales_by_priority <- cleaned_data %>%
  group_by(OrderPriority) %>%
  summarise(TotalSales = sum(Sales, na.rm = TRUE))

ggplot(sales_by_priority, aes(x = reorder(OrderPriority, TotalSales), y = TotalSales)) +
  geom_bar(stat = "identity", fill = "orange") +
  coord_flip() +
  labs(
    title = "Sales Distribution by Order Priority",
    x = "Order Priority",
    y = "Total Sales"
  ) +
  theme_minimal()
```

```{r}
# Top 10 countries by total sales
top_countries <- sales_by_country %>%
  arrange(desc(TotalSales)) %>%
  slice(1:10)

ggplot(top_countries, aes(x = reorder(Country, TotalSales), y = TotalSales)) +
  geom_bar(stat = "identity", fill = "lightcoral") +
  coord_flip() +
  labs(
    title = "Top 10 Countries by Total Sales",
    x = "Country",
    y = "Total Sales"
  ) +
  theme_minimal()


```
```{r}
# Total Sales by Category and Return Status
sales_by_category_return <- cleaned_data %>%
  group_by(Category, ReturnStatus) %>%
  summarise(TotalSales = sum(Sales, na.rm = TRUE))

ggplot(sales_by_category_return, aes(x = Category, y = TotalSales, fill = ReturnStatus)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(
    title = "Total Sales by Category and Return Status",
    x = "Category",
    y = "Total Sales",
    fill = "Return Status"
  ) +
  theme_minimal()
```
```{r}
# Calculate total sales by return status
sales_by_return_status <- cleaned_data %>%
  group_by(ReturnStatus) %>%
  summarise(TotalSales = sum(Sales, na.rm = TRUE)) %>%
  mutate(Percentage = TotalSales / sum(TotalSales) * 100)

# Create the bar plot with percentages
ggplot(sales_by_return_status, aes(x = ReturnStatus, y = TotalSales, fill = ReturnStatus)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = paste0(round(Percentage, 1), "%")), vjust = -0.5, color = "black") +  # Add percentage labels
  labs(title = "Sales by Return Status", x = "Return Status", y = "Total Sales") +
  theme_minimal()

```
```{r}
ggplot(cleaned_data, aes(x = Discount, y = Sales)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", color = "red") +
  labs(title = "Discount vs Sales", x = "Discount", y = "Sales") +
  theme_minimal()
```
```{r}
sales_by_shipment_provider <- cleaned_data %>%
  group_by(ShipmentProvider) %>%
  summarise(TotalSales = sum(Sales, na.rm = TRUE))

ggplot(sales_by_shipment_provider, aes(x = reorder(ShipmentProvider, TotalSales), y = TotalSales, fill = ShipmentProvider)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(title = "Sales by Shipment Provider", x = "Shipment Provider", y = "Total Sales") +
  theme_minimal()

```


